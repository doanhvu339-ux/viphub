--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera

--// Variables
local autoClick = false
local clickInterval = 0.1
local lastClick = 0

--// GUI Setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BlueSkyAutoClicker"
screenGui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 220, 0, 100)
frame.Position = UDim2.new(0.5, -110, 0.5, -50)
frame.BackgroundColor3 = Color3.fromRGB(135, 206, 235)
frame.BorderSizePixel = 0
frame.AnchorPoint = Vector2.new(0.5, 0.5)
frame.Parent = screenGui

local uicorner = Instance.new("UICorner")
uicorner.CornerRadius = UDim.new(0, 15)
uicorner.Parent = frame

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundTransparency = 1
title.Text = "BlueSky AutoClicker"
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Parent = frame

-- Nút bật/tắt
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0.8, 0, 0, 40)
toggleButton.Position = UDim2.new(0.1, 0, 0.5, -20)
toggleButton.BackgroundColor3 = Color3.fromRGB(100, 149, 237)
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 16
toggleButton.Text = "AutoClick: OFF"
toggleButton.Parent = frame

local toggleUICorner = Instance.new("UICorner")
toggleUICorner.CornerRadius = UDim.new(0, 10)
toggleUICorner.Parent = toggleButton

toggleButton.MouseButton1Click:Connect(function()
    autoClick = not autoClick
    toggleButton.Text = autoClick and "AutoClick: ON" or "AutoClick: OFF"
end)

--// Function: Find closest part with ClickDetector to center screen
local function getCenterTarget()
    local viewportSize = camera.ViewportSize
    local center = Vector2.new(viewportSize.X/2, viewportSize.Y/2)
    local closestPart = nil
    local shortestDist = math.huge

    for _, part in ipairs(Workspace:GetDescendants()) do
        if part:IsA("BasePart") and part:FindFirstChild("ClickDetector") then
            local screenPos, onScreen = camera:WorldToViewportPoint(part.Position)
            if onScreen then
                local dist = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude
                if dist < shortestDist then
                    shortestDist = dist
                    closestPart = part
                end
            end
        end
    end
    return closestPart
end

--// AutoClick Logic
RunService.RenderStepped:Connect(function()
    if autoClick and tick() - lastClick >= clickInterval then
        lastClick = tick()
        local targetPart = getCenterTarget()
        if targetPart then
            fireclickdetector(targetPart.ClickDetector)
        end
    end
end)
