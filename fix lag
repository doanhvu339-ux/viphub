local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local Camera = Workspace.CurrentCamera

-- Giữ bóng đổ nhưng giảm độ nặng
Lighting.GlobalShadows = true
Lighting.ShadowSoftness = 0.5

-- Tối ưu particle
for _, emitter in pairs(Workspace:GetDescendants()) do
    if emitter:IsA("ParticleEmitter") then
        emitter.Rate = math.min(emitter.Rate, 50)
        emitter.Lifetime = NumberRange.new(math.min(emitter.Lifetime.Max, 2))
    end
end

-- Giảm chi tiết vật thể xa nhưng vẫn thấy người chơi
for _, part in pairs(Workspace:GetDescendants()) do
    if part:IsA("BasePart") and not part:IsDescendantOf(Workspace.Players) then
        local distance = (part.Position - Camera.CFrame.Position).Magnitude
        if distance > 100 then
            part.CastShadow = false
            if part:FindFirstChildWhichIsA("Texture") then
                part.Texture.Transparency = 0.4
            end
        else
            part.CastShadow = true
            if part:FindFirstChildWhichIsA("Texture") then
                part.Texture.Transparency = 0
            end
        end
    end
end

-- Giữ hiệu ứng hậu kỳ nhẹ
local bloom = Lighting:FindFirstChildOfClass("BloomEffect")
if bloom then
    bloom.Intensity = math.min(bloom.Intensity, 0.3)
end

local sunRays = Lighting:FindFirstChildOfClass("SunRaysEffect")
if sunRays then
    sunRays.Intensity = math.min(sunRays.Intensity, 0.2)
end
